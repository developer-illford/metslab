<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div class="prxv_slider" id="prxv_slider">
        <div class="prxv_slider__content" id="prxv_slider-content">
            <div class="prxv_slider__images">
                <div class="prxv_slider__images-item prxv_slider__images-item--active" data-id="1"><img
                        src="img/about_background.png" />
                </div>
            </div>
            <div class="prxv_slider__text">
                <div class="prxv_slider__text-item prxv_slider__text-item--active" data-id="1">
                    <div class="prxv_slider__text-item-head">
                        <h3>Forest</h3>
                    </div>
                    <div class="prxv_slider__text-item-info">
                        <p>“And into the forest I go, to lose my mind and find my soul”</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="prxv_slider__nav">
            <div class="prxv_slider__nav-arrows">
                <div class="prxv_slider__nav-arrow prxv_slider__nav-arrow--left" id="left">to left</div>
                <div class="prxv_slider__nav-arrow prxv_slider__nav-arrow--right" id="right">to right</div>
            </div>
            <div class="prxv_slider__nav-dots" id="prxv_slider-dots">

            </div>
        </div>
    </div>
    <style>


        :root {
            --z-distance: 8.519vw;
            --from-left: 1;
            --mobile-bkp: 650px;
        }

        body{
            overflow: hidden;
        }

        .prxv_slider {
            width: 100vw;
            height: 100vh;
            display: flex;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .prxv_slider::before,
        .prxv_slider::after {
            content: '';
            left: -1vw;
            top: -1vh;
            display: block;
            position: absolute;
            width: 102vw;
            height: 102vh;
            background-position: center;
            background-size: cover;
            will-change: opacity;
            z-index: -1;
            box-shadow: 0 0 0 50vmax rgba(0, 0, 0, 0.7) inset;
        }

        .prxv_slider::before {
            background-image: var(--img-prev);
        }

        .prxv_slider::after {
            transition: opacity 0.7s;
            opacity: 0;
            background-image: var(--img-next);
        }

        .prxv_slider--bg-next::after {
            opacity: 1;
        }

        .prxv_slider__content {
            margin: auto;
            width: 65vw;
            height: 32.5vw;
            max-height: 60vh;
            will-change: transform;
            transform-style: preserve-3d;
            pointer-events: none;
            transform: translateZ(var(--z-distance));
        }

        .prxv_slider__images {
            overflow: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 0;
            box-shadow: 0 0 5em #000;
        }

        .prxv_slider__images-item {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            will-change: transform;
            transition-timing-function: ease-in;
            visibility: hidden;
        }

        .prxv_slider__images-item img {
            display: block;
            position: relative;
            left: -1em;
            top: -1em;
            width: calc(100% + 1em * 2);
            height: calc(100% + 1em * 2);
            object-fit: cover;
            will-change: transform;
        }

        .prxv_slider__images-item--active {
            z-index: 20;
            visibility: visible;
        }

        .prxv_slider__images-item--subactive {
            z-index: 15;
            visibility: visible;
        }

        .prxv_slider__images-item--next {
            transform: translateX(100%);
        }

        .prxv_slider__images-item--prev {
            transform: translateX(-100%);
        }

        .prxv_slider__images-item--transit {
            transition: transform 0.7s, opacity 0.7s;
        }

        .prxv_slider__text {
            position: relative;
            height: 100%;
        }

        .prxv_slider__text-item {
            position: absolute;
            width: 100%;
            height: 100%;
            padding: 0.5em;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .prxv_slider__text-item>* {
            overflow: hidden;
            position: absolute;
        }

        .prxv_slider__text-item h3,
        .prxv_slider__text-item p {
            transition: transform 0.35s ease-out;
            line-height: 1.5;
            overflow: hidden;
        }

        .prxv_slider__text-item h3 {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .prxv_slider__text-item p {
            font-family: 'Open Sans', sans-serif;
            padding: 1em;
            color: white;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .prxv_slider__text-item h3::before,
        .prxv_slider__text-item p::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 105%;
            height: 100%;
            transform: translateX(0);
            transition: transform 0.35s ease-out 0.28s;
        }

        .prxv_slider__text-item h3::before {
            background-color: #000;
        }

        .prxv_slider__text-item p::before {
            background-color: #fff;
        }

        .prxv_slider__text-item h3 {
            margin: 0;
            font-size: 3.5em;
            padding: 0 .3em;
            position: relative;
            font-weight: 700;
            transform: translateX(-100%);
        }

        .prxv_slider__text-item p {
            margin: 0;
            transform: translateX(100%);
        }

        .prxv_slider__text-item-head {
            top: -0.5em;
            transform: translateZ(3em);
        }

        .prxv_slider__text-item-info {
            bottom: 0;
            right: 0;
            max-width: 75%;
            min-width: min-content;
            transform: translateZ(2em);
        }

        .prxv_slider__text-item--active h3,
        .prxv_slider__text-item--active p {
            transform: translateX(0);
        }

        .prxv_slider__text-item--active h3::before {
            transform: translateX(102%);
        }

        .prxv_slider__text-item--active p::before {
            transform: translateX(-102%);
        }

        .prxv_slider__text-item--backwards h3::before,
        .prxv_slider__text-item--backwards p::before {
            transition: transform 0.35s ease-in;
        }

        .prxv_slider__text-item--backwards h3,
        .prxv_slider__text-item--backwards p {
            transition: transform 0.35s ease-in 0.35s;
        }

        .prxv_slider__nav {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            text-align: center;
        }

        .prxv_slider__nav-arrows {
            display: flex;
            justify-content: space-between;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .prxv_slider__nav-arrow {
            height: 100vh;
            width: 50vw;
            text-indent: -9999px;
            white-space: nowrap;
        }
    </style>

<script>
    function lerp({ x, y }, { x: targetX, y: targetY }) {
        const fraction = 0.1;
        x += (targetX - x) * fraction;
        y += (targetY - y) * fraction;
        return { x, y };
    }

    class prxv_slider {
        constructor(el) {
            this.el = el;
            this.contentEl = document.getElementById("prxv_slider-content");
            this.image = el.getElementsByTagName("img")[0];

            this.onMouseMove = this.onMouseMove.bind(this);

            window.addEventListener("resize", this.onResize.bind(this));
            this.onResize();

            this.lastX = this.lastY = this.targetX = this.targetY = 0;
        }

        onResize() {
            const htmlStyles = getComputedStyle(document.documentElement);
            const mobileBreakpoint = htmlStyles.getPropertyValue("--mobile-bkp");

            this.isMobile = matchMedia(
                `only screen and (max-width: ${mobileBreakpoint})`
            ).matches;

            this.halfWidth = innerWidth / 2;
            this.halfHeight = innerHeight / 2;
            this.zDistance = htmlStyles.getPropertyValue("--z-distance");

            if (!this.isMobile && !this.mouseWatched) {
                this.mouseWatched = true;
                this.el.addEventListener("mousemove", this.onMouseMove);
                this.contentEl.style.setProperty(
                    "transform",
                    `translateZ(${this.zDistance})`
                );

                // Set background image
                this.setBackgroundImage();
            } else if (this.isMobile && this.mouseWatched) {
                this.mouseWatched = false;
                this.el.removeEventListener("mousemove", this.onMouseMove);
                this.contentEl.style.setProperty("transform", "none");
            }
        }

        setBackgroundImage() {
            const imageUrl = `url(${this.image.src})`;
            this.el.style.setProperty("--img-prev", imageUrl);
        }

        getMouseCoefficients({ pageX, pageY } = {}) {
            const xCoeff = ((pageX || this.targetX) - this.halfWidth) / this.halfWidth;
            const yCoeff = (this.halfHeight - (pageY || this.targetY)) / this.halfHeight;
            return { xCoeff, yCoeff };
        }

        onMouseMove({ pageX, pageY }) {
            this.targetX = pageX;
            this.targetY = pageY;

            if (!this.animationRunning) {
                this.animationRunning = true;
                this.runAnimation();
            }
        }

        runAnimation() {
            if (this.animationStopped) {
                this.animationRunning = false;
                return;
            }

            const maxX = 10;
            const maxY = 10;

            const newPos = lerp(
                { x: this.lastX, y: this.lastY },
                { x: this.targetX, y: this.targetY }
            );

            const { xCoeff, yCoeff } = this.getMouseCoefficients({
                pageX: newPos.x,
                pageY: newPos.y
            });

            this.lastX = newPos.x;
            this.lastY = newPos.y;

            this.positionImage({ xCoeff, yCoeff });

            this.contentEl.style.setProperty(
                "transform",
                `translateZ(${this.zDistance}) rotateX(${maxY * yCoeff}deg) rotateY(${maxX * xCoeff}deg)`
            );

            if (this.reachedFinalPoint) {
                this.animationRunning = false;
            } else {
                requestAnimationFrame(this.runAnimation.bind(this));
            }
        }

        get reachedFinalPoint() {
            const lastX = ~~this.lastX;
            const lastY = ~~this.lastY;
            return (
                (lastX === this.targetX || lastX - 1 === this.targetX || lastX + 1 === this.targetX) &&
                (lastY === this.targetY || lastY - 1 === this.targetY || lastY + 1 === this.targetY)
            );
        }

        positionImage({ xCoeff, yCoeff }) {
            const maxImgOffset = 1;
            this.image.style.setProperty(
                "transform",
                `translateX(${maxImgOffset * -xCoeff}em) translateY(${maxImgOffset * yCoeff}em)`
            );
        }
    }

    const prxv_sliderEl = document.getElementById("prxv_slider");
    new prxv_slider(prxv_sliderEl);
</script>


</body>

</html>